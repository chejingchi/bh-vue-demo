{"version":3,"sources":["webpack:///js/0.8442de7ad483641b14db.js","webpack:///./src/pages/plugin/plugin.vue","webpack:///./src/pages/plugin/plugin.vue?3d1f","webpack:///plugin.vue"],"names":["webpackJsonp","129","module","exports","__webpack_require__","__vue_script__","__vue_template__","__vue_styles__","__esModule","default","__vue_options__","options","template","computed","Object","keys","forEach","key","241","364","_interopRequireDefault","obj","defineProperty","value","_vue","_vue2","_router","_router2","_","util","_cachedApp","_loadScript","url","callback","head","document","getElementsByTagName","script","createElement","type","onreadystatechange","this","readyState","onload","src","appendChild","_loadWidget","vm","widgetName","dfd","$","Deferred","indexOf","app","resolve","promise","widgetUrl","push","data","fullPath","path","methods","widgetActive","routes","console","log","$router","matched","_currentTransition","to","len","length","segments","i","handler","addSubRouter","extend","route","activate","transition","next","appId","params","id","name","replace","done"],"mappings":"AAAAA,cAAc,EAAE,KAEVC,IACA,SAASC,EAAQC,EAASC,GCHhC,GAAAC,GAAAC,EACAC,IACAF,GAAAD,EAAA,KACAE,EAAAF,EAAA,KACAF,EAAAC,QAAAE,MACAH,EAAAC,QAAAK,aAAAN,EAAAC,QAAAD,EAAAC,QAAAM,QACA,IAAAC,GAAA,kBAAAR,GAAAC,QAAAD,EAAAC,QAAAQ,UAAAT,EAAAC,QAAAQ,YAAoHT,EAAAC,OACpHG,KACAI,EAAAE,SAAAN,GAEAI,EAAAG,WAAAH,EAAAG,aACAC,OAAAC,KAAAR,GAAAS,QAAA,SAAAC,GACA,GAAAf,GAAAK,EAAAU,EACAP,GAAAG,SAAAI,GAAA,WAA6C,MAAAf,ODWvCgB,IACA,SAAShB,EAAQC,GEzBvBD,EAAAC,QAAA,iGF+BMgB,IACA,SAASjB,EAAQC,EAASC,GAE/B,YAcA,SAASgB,GAAuBC,GAAO,MAAOA,IAAOA,EAAIb,WAAaa,GAAQZ,QAASY,GAZvFP,OAAOQ,eAAenB,EAAS,cAC3BoB,OAAO,GG9BZ,IAAAC,GAAApB,EAAA,IHmCKqB,EAAQL,EAAuBI,GGlCpCE,EAAAtB,EAAA,KHsCKuB,EAAWP,EAAuBM,GGpCvCE,EAAAH,EAAAhB,QAAAoB,KAEAC,KAEAC,EAAA,SAAAC,EAAAC,GHyCK,GAAIC,GAAOC,SAASC,qBAAqB,QGvC9C,GHwCSC,EAASF,SAASG,cGvC3B,SHwCKD,GAAOE,KGvCZ,kBHwCKF,EAAOG,mBAAqB,WACA,aAApBC,KAAKC,YGtClBT,KH2CKI,EAAOM,OAAS,WGtCrBV,KH0CKI,EAAOO,IGvCZZ,EHwCKE,EAAKW,YGvCVR,IAEAS,EAAA,SAAAC,EAAAC,GHyCK,GAAIC,GAAMC,EGrCfC,UHuCK,IAAIrB,EAAWsB,QAAQJ,IAAc,EAGjC,MAFAD,GAAGM,IGtCZL,EHuCSC,EGtCTK,UHuCgBL,EGtChBM,SHyCK,IAAIC,GAAY,SAAWR,EGtChC,KH6CK,OANAjB,GAAYyB,EAAW,WACnBT,EAAGM,IGrCZL,EHsCSlB,EAAW2B,KGrCpBT,GHsCSC,EGrCTK,YHwCYL,EGrCZM,UHwCCpD,GAAQM,SACJiD,KAAM,WACF,OACIC,SGrCb,GHsCaC,KGrCb,GHsCaP,IGpCb,OHwCKQ,SACIC,aAAc,SAAsBC,GAChCC,QAAQC,IAAIxB,KGtCzByB,QH2Ca,KAAK,GAJDC,GAAU1B,KAAKyB,QAAQE,mBAAmBC,GGrC3DF,QHuCiBG,EAAMH,EGtCvBI,OHuCiBC,KACKC,EAAI,EAAGA,EAAIH,EAAKG,IACrBD,EAASf,MACLG,KAAMO,EAAQM,GAAGC,QGtCtCd,KHuCqBc,QAASP,EAAQM,GGrCtCC,SHyCa,KAAK,GAAId,KAAQG,GGtC9B,CHuCiB,GAAIW,GAAUX,EGtC/BH,EHuCiBjC,GAASlB,QAAQkE,aAAaf,EAAMc,EAAS9C,EAAEgD,UGtChEJ,OH0CKK,OACIC,SAAU,SAAkBC,GACxB,GAAIZ,GAAUY,EAAWV,GGtCtCF,OHuCa1B,MAAKkB,SAAWQ,EAAQA,EAAQI,OAAS,GAAGG,QGtCzDf,SHuCaoB,EGtCbC,QHwCStB,KAAM,SAAcqB,GAChB,GAAIE,GAAQF,EAAWV,GAAGa,OGtCvCC,GHuCiBC,EGtCjBH,CHuCaxC,MAAKmB,KAAOnB,KAAKkB,SAAS0B,QAAQ,MGtC/CJ,GHuCanC,EAAYL,KAAM2C,GAAME,KAAK,WACzBP,EGtCjBC","file":"js/0.8442de7ad483641b14db.js","sourcesContent":["webpackJsonp([0,34],{\n\n/***/ 129:\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar __vue_script__, __vue_template__\n\tvar __vue_styles__ = {}\n\t__vue_script__ = __webpack_require__(364)\n\t__vue_template__ = __webpack_require__(241)\n\tmodule.exports = __vue_script__ || {}\n\tif (module.exports.__esModule) module.exports = module.exports.default\n\tvar __vue_options__ = typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports\n\tif (__vue_template__) {\n\t__vue_options__.template = __vue_template__\n\t}\n\tif (!__vue_options__.computed) __vue_options__.computed = {}\n\tObject.keys(__vue_styles__).forEach(function (key) {\n\tvar module = __vue_styles__[key]\n\t__vue_options__.computed[key] = function () { return module }\n\t})\n\n\n/***/ },\n\n/***/ 241:\n/***/ function(module, exports) {\n\n\tmodule.exports = \" <div> <component :is=app :context-path=path @widget-active=widgetActive></component> </div> \";\n\n/***/ },\n\n/***/ 364:\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _vue = __webpack_require__(79);\n\t\n\tvar _vue2 = _interopRequireDefault(_vue);\n\t\n\tvar _router = __webpack_require__(124);\n\t\n\tvar _router2 = _interopRequireDefault(_router);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar _ = _vue2.default.util;\n\t\n\tvar _cachedApp = [];\n\t\n\tvar _loadScript = function _loadScript(url, callback) {\n\t    var head = document.getElementsByTagName('head')[0];\n\t    var script = document.createElement('script');\n\t    script.type = 'text/javascript';\n\t    script.onreadystatechange = function () {\n\t        if (this.readyState === 'complete') {\n\t            callback();\n\t        }\n\t    };\n\t\n\t    script.onload = function () {\n\t        callback();\n\t    };\n\t\n\t    script.src = url;\n\t    head.appendChild(script);\n\t};\n\t\n\tvar _loadWidget = function _loadWidget(vm, widgetName) {\n\t    var dfd = $.Deferred();\n\t\n\t    if (_cachedApp.indexOf(widgetName) > -1) {\n\t        vm.app = widgetName;\n\t        dfd.resolve();\n\t        return dfd.promise();\n\t    }\n\t\n\t    var widgetUrl = '/apps/' + widgetName + '.js';\n\t    _loadScript(widgetUrl, function () {\n\t        vm.app = widgetName;\n\t        _cachedApp.push(widgetName);\n\t        dfd.resolve();\n\t    });\n\t\n\t    return dfd.promise();\n\t};\n\t\n\texports.default = {\n\t    data: function data() {\n\t        return {\n\t            fullPath: '',\n\t            path: '',\n\t            app: null\n\t        };\n\t    },\n\t\n\t    methods: {\n\t        widgetActive: function widgetActive(routes) {\n\t            console.log(this.$router);\n\t            var matched = this.$router._currentTransition.to.matched;\n\t\n\t            var len = matched.length;\n\t            var segments = [];\n\t            for (var i = 0; i < len; i++) {\n\t                segments.push({\n\t                    path: matched[i].handler.path,\n\t                    handler: matched[i].handler\n\t                });\n\t            }\n\t\n\t            for (var path in routes) {\n\t                var handler = routes[path];\n\t                _router2.default.addSubRouter(path, handler, _.extend([], segments));\n\t            }\n\t        }\n\t    },\n\t    route: {\n\t        activate: function activate(transition) {\n\t            var matched = transition.to.matched;\n\t            this.fullPath = matched[matched.length - 1].handler.fullPath;\n\t            transition.next();\n\t        },\n\t        data: function data(transition) {\n\t            var appId = transition.to.params.id;\n\t            var name = appId;\n\t            this.path = this.fullPath.replace(':id', appId);\n\t            _loadWidget(this, name).done(function () {\n\t                transition.next();\n\t            });\n\t        }\n\t    }\n\t};\n\n/***/ }\n\n});\n\n\n// WEBPACK FOOTER //\n// js/0.8442de7ad483641b14db.js","var __vue_script__, __vue_template__\nvar __vue_styles__ = {}\n__vue_script__ = require(\"!!babel-loader?presets[]=es2015&plugins[]=transform-runtime&comments=false!./../../../node_modules/.8.5.4@vue-loader/lib/selector.js?type=script&index=0!./plugin.vue\")\n__vue_template__ = require(\"!!vue-html-loader!./../../../node_modules/.8.5.4@vue-loader/lib/selector.js?type=template&index=0!./plugin.vue\")\nmodule.exports = __vue_script__ || {}\nif (module.exports.__esModule) module.exports = module.exports.default\nvar __vue_options__ = typeof module.exports === \"function\" ? (module.exports.options || (module.exports.options = {})) : module.exports\nif (__vue_template__) {\n__vue_options__.template = __vue_template__\n}\nif (!__vue_options__.computed) __vue_options__.computed = {}\nObject.keys(__vue_styles__).forEach(function (key) {\nvar module = __vue_styles__[key]\n__vue_options__.computed[key] = function () { return module }\n})\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/pages/plugin/plugin.vue\n// module id = 129\n// module chunks = 0","module.exports = \" <div> <component :is=app :context-path=path @widget-active=widgetActive></component> </div> \";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/.1.2.3@vue-html-loader!./~/.8.5.4@vue-loader/lib/selector.js?type=template&index=0!./src/pages/plugin/plugin.vue\n// module id = 241\n// module chunks = 0","<template>\n    <div>\n        <component :is='app' :context-path='path' @widget-active='widgetActive'></component>\n    </div>\n</template>\n\n<script>\n    import Vue from 'vue';\n    import router from 'src/router';\n\n    var _ = Vue.util;\n\n    var _cachedApp = [];\n\n    var _loadScript = (url, callback) => {\n        var head = document.getElementsByTagName('head')[0];\n        var script = document.createElement('script');\n        script.type = 'text/javascript';\n        script.onreadystatechange = function () {\n            if (this.readyState === 'complete') {\n                callback();\n            }\n        };\n\n        script.onload = function () {\n            callback();\n        };\n\n        script.src = url;\n        head.appendChild(script);\n    };\n\n    var _loadWidget = (vm, widgetName) => {\n        var dfd = $.Deferred();\n\n        // 已经加载过的app，可以直接使用\n        if (_cachedApp.indexOf(widgetName) > -1) {\n            vm.app = widgetName;\n            dfd.resolve();\n            return dfd.promise();\n        }\n\n        var widgetUrl = '/apps/' + widgetName + '.js';\n        _loadScript(widgetUrl, () => {\n            // console.log(widgetName + ' loaded');\n            vm.app = widgetName;\n            _cachedApp.push(widgetName);\n            dfd.resolve();\n        });\n\n        return dfd.promise();\n    };\n\n    export default {\n        data () {\n            return {\n                fullPath: '',\n                path: '',\n                app: null\n            };\n        },\n        methods: {\n            widgetActive (routes) {\n                console.log(this.$router);\n                var matched = this.$router._currentTransition.to.matched;\n\n                var len = matched.length;\n                var segments = [];\n                for (var i = 0; i < len; i++) {\n                    segments.push({\n                        path: matched[i].handler.path,\n                        handler: matched[i].handler\n                    });\n                }\n\n                for (var path in routes) {\n                    var handler = routes[path];\n                    router.addSubRouter(path, handler, _.extend([], segments));\n                }\n            }\n        },\n        route: {\n            activate (transition) {\n                var matched = transition.to.matched;\n                this.fullPath = matched[matched.length - 1].handler.fullPath;\n                transition.next();\n            },\n            data (transition) {\n                var appId = transition.to.params.id;\n                var name = appId;\n                this.path = this.fullPath.replace(':id', appId);\n                _loadWidget(this, name).done(() => {\n                    transition.next();\n                });\n            }\n        }\n    };\n</script>\n\n\n\n// WEBPACK FOOTER //\n// plugin.vue?0bf44d94"],"sourceRoot":""}